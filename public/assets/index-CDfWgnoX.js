import{r as s,G as w,j as e,I as g,i as _,c as C,u as R,a as $}from"./index-DZu0jUOh.js";import{L as q,c as B}from"./Linkline-BVE7q3mI.js";import{P as F}from"./ProductsList-C8WnN_nq.js";import{L as G}from"./Loader-CdfK6LLs.js";import"./ProductCard-n_G8EIMu.js";const M=s.memo(({label:r,selected:u,options:t,onChange:a})=>{const{theme:n}=s.useContext(w),[o,p]=s.useState(!1),c=s.useRef(null);s.useEffect(()=>{const l=x=>{c.current&&!c.current.contains(x.target)&&p(!1)};return document.addEventListener("mousedown",l),()=>{document.removeEventListener("mousedown",l)}},[]);const i=s.useCallback(()=>p(l=>!l),[]),d=s.useCallback(l=>{a(l),p(!1)},[a]);return e.jsxs("div",{ref:c,className:"dropdown",children:[e.jsx("div",{className:"dropdown__label",children:r}),e.jsxs("button",{className:`dropdown__button ${o?"dropdown__button--open":""}`,onClick:i,children:[e.jsx("div",{className:"dropdown__title",children:u}),e.jsx("div",{className:"dropdown__icon",children:e.jsx(g,{icon:o?_.arrow_down[n]:_.arrow_right[n]})})]}),o&&e.jsx("ul",{className:"dropdown__options",children:t.map(l=>e.jsx("li",{className:"dropdown__option",onClick:()=>d(l),children:l},l))})]})});M.displayName="Dropdown";const N=4,D=({total:r,perPage:u,currentPage:t,onPageChange:a})=>{const{theme:n}=s.useContext(w),o=s.useMemo(()=>Math.ceil(r/u),[u,r]),[p,c]=s.useMemo(()=>{let i=Math.max(1,t-1),d=Math.min(o,t+2);return d-i+1<N&&(i===1?d=Math.min(o,i+N-1):i=Math.max(1,d-N+1)),[i,d]},[t,o]);return e.jsxs("div",{className:"pagination",children:[e.jsx("button",{className:C("pagination__button",{"pagination__button--disabled":t===1}),onClick:()=>a(t-1),disabled:t===1,children:t===1?e.jsx(g,{icon:_.arrow_left__disabled[n]}):e.jsx(g,{icon:_.arrow_left[n]})}),e.jsx("div",{className:"pagination__button-container",children:Array.from({length:c-p+1},(i,d)=>e.jsx("button",{className:C("pagination__button-page",{"pagination__button-page--active":t===p+d}),onClick:()=>a(p+d),children:p+d},p+d))}),e.jsx("button",{className:C("pagination__button",{"pagination__button--disabled":t===o}),onClick:()=>a(t+1),disabled:t===o,children:t===o?e.jsx(g,{icon:_.arrow_right__disabled[n]}):e.jsx(g,{icon:_.arrow_right[n]})}),e.jsxs("p",{children:["Total pages: ",o]})]})};function y(r,u){const t=new URLSearchParams(r.toString());return Object.entries(u).forEach(([a,n])=>{n===null?t.delete(a):Array.isArray(n)?(t.delete(a),n.forEach(o=>{t.append(a,o)})):t.set(a,n)}),t.toString()}const U=(r,{sortBy:u,query:t})=>{let a=[...r];switch(t&&(a=a.filter(n=>n.name.toLowerCase().includes(t.toLowerCase().trim()))),u){case"Newest":return a.sort((n,o)=>o.year-n.year);case"Alphabetically":return a.sort((n,o)=>n.name.localeCompare(o.name));case"Cheapest":return a.sort((n,o)=>n.fullPrice-o.fullPrice);default:return a}},K=({category:r})=>{const{allProducts:u}=s.useContext(w),{theme:t}=s.useContext(w),[a,n]=s.useState(!1),[o,p]=s.useState(null),[c,i]=R(),d=c.get("sort")||"Alphabetically",l=c.get("perPage")||"All",x=Number(c.get("page"))||1,j=c.get("query")||"",k=$(),A=s.useCallback(()=>{window.scrollTo({top:0,behavior:"smooth"})},[]),v=s.useMemo(()=>k.pathname.split("/")[1],[k.pathname]),L=s.useMemo(()=>u.filter(m=>m.category===r),[u,r]),h=s.useMemo(()=>U(L,{sortBy:d,query:j}),[L,j,d]),b=s.useMemo(()=>h.length,[h.length]),S=s.useCallback(m=>{i(y(c,m==="Alphabetically"?{sort:null}:{sort:m}))},[c,i]),T=s.useCallback(m=>{i(y(c,m==="All"?{perPage:null,page:null}:{perPage:m,page:"1"}))},[c,i]),E=s.useCallback(m=>{const P=m===1?{page:null}:{page:String(m)};i(y(c,P))},[c,i]),I=s.useMemo(()=>l==="All"?1:Math.ceil(b/+l),[b,l]),f=s.useMemo(()=>(x-1)*+l,[x,l]),O=s.useMemo(()=>l==="All"?h:h.slice(f,f+ +l),[l,f,h]);return s.useEffect(()=>{n(!0),p(null);const m=setTimeout(()=>{try{(!u||u.length===0)&&p("Failed to load products")}catch{p("Failed to load products")}finally{n(!1)}},1e3);return()=>clearTimeout(m)},[r,u]),e.jsxs("div",{className:"productsPage",children:[a&&e.jsx(G,{}),!a&&o&&e.jsxs("div",{className:"productsPage__error",children:[e.jsx("p",{children:"Something went wrong. Please try again."}),e.jsx("button",{onClick:()=>window.location.reload(),children:"Reload"})]}),!a&&!o&&!h.length&&!j?e.jsx("div",{className:"productsPage__no-products",children:e.jsxs("p",{children:["There are no ",r," yet."]})}):null,!a&&!o&&!h.length&&j?e.jsx("p",{className:"productsPage__no-products",children:`There are no ${v} matching the query`}):null,!a&&!o&&h.length?e.jsxs(e.Fragment,{children:[e.jsx(q,{productType:r}),e.jsx("h1",{className:"productsPage__title",children:r&&`${B(r)} page`}),e.jsx("span",{className:"productsPage__description",children:`${b} model${b!==1?"s":""}`}),e.jsxs("div",{className:"productsPage__dropdown",children:[e.jsx("div",{className:"productsPage__dropdown--sortBy",children:e.jsx(M,{label:"Sort by",selected:d,options:["Newest","Cheapest","Alphabetically"],onChange:S})}),e.jsx("div",{className:"productsPage__dropdown--itemsPerPage",children:e.jsx(M,{label:"Items on page",selected:l,options:["4","8","16","All"],onChange:T})})]}),e.jsx("button",{className:"buttonUp",onClick:A,children:e.jsx(g,{icon:_.arrow_left[t]})}),e.jsx(F,{products:O,displayType:"with-discount"}),l!=="All"&&I>1&&e.jsx(D,{total:b,perPage:+l,currentPage:x,onPageChange:E})]}):null]})};export{K as ProductPage};
